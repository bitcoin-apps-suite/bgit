{"version":3,"file":"run.cjs","names":["Command","pkg.bin","pkg.version","userConfig: Record<string, unknown>","createClient"],"sources":["../package.json","../src/cli.ts","../src/run.ts"],"sourcesContent":["","import type { OptionValues } from 'commander';\nimport { Command } from 'commander';\n\nimport { createClient } from '~/index';\n\nimport pkg from '../package.json' assert { type: 'json' };\n\nconst stringToBoolean = (\n  value: string | undefined,\n): boolean | string | undefined => {\n  if (value === 'true') return true;\n  if (value === 'false') return false;\n  return value;\n};\n\nconst processParams = (\n  obj: OptionValues,\n  booleanKeys: ReadonlyArray<string>,\n): OptionValues => {\n  for (const key of booleanKeys) {\n    const value = obj[key];\n    if (typeof value === 'string') {\n      const parsedValue = stringToBoolean(value);\n      delete obj[key];\n      obj[key] = parsedValue;\n    }\n  }\n  return obj;\n};\n\nexport const runCli = async (): Promise<void> => {\n  const params = new Command()\n    .name(Object.keys(pkg.bin)[0]!)\n    .usage('[options]')\n    .version(pkg.version)\n    .option('-c, --client <value>', 'HTTP client to generate')\n    .option('-d, --debug', 'Set log level to debug')\n    .option('--dry-run [value]', 'Skip writing files to disk?')\n    .option('-f, --file [value]', 'Path to the config file')\n    .option(\n      '-i, --input <value>',\n      'OpenAPI specification (path, url, or string content)',\n    )\n    .option('-l, --logs [value]', 'Logs folder')\n    .option('-o, --output <value>', 'Output folder')\n    .option('-p, --plugins [value...]', \"List of plugins you'd like to use\")\n    .option('-s, --silent', 'Set log level to silent')\n    .option(\n      '--no-log-file',\n      'Disable writing a log file. Works like --silent but without suppressing console output',\n    )\n    .option(\n      '-w, --watch [value]',\n      'Regenerate the client when the input file changes?',\n    )\n    .parse(process.argv)\n    .opts();\n\n  let userConfig: Record<string, unknown>;\n\n  try {\n    userConfig = processParams(params, ['dryRun', 'logFile']);\n\n    if (userConfig.file) {\n      userConfig.configFile = userConfig.file;\n      delete userConfig.file;\n    }\n\n    if (params.plugins === true) {\n      userConfig.plugins = [];\n    } else if (params.plugins) {\n      userConfig.plugins = params.plugins;\n    } else if (userConfig.client) {\n      userConfig.plugins = ['@hey-api/typescript', '@hey-api/sdk'];\n    }\n\n    if (userConfig.client) {\n      (userConfig.plugins as Array<string>).push(userConfig.client as string);\n      delete userConfig.client;\n    }\n\n    userConfig.logs = userConfig.logs\n      ? {\n          path: userConfig.logs,\n        }\n      : {};\n\n    if (userConfig.debug) {\n      (userConfig.logs as Record<string, unknown>).level = 'debug';\n      delete userConfig.debug;\n    } else if (userConfig.silent) {\n      (userConfig.logs as Record<string, unknown>).level = 'silent';\n      delete userConfig.silent;\n    }\n\n    (userConfig.logs as Record<string, unknown>).file = userConfig.logFile;\n    delete userConfig.logFile;\n\n    if (typeof params.watch === 'string') {\n      userConfig.watch = Number.parseInt(params.watch, 10);\n    }\n\n    if (!Object.keys(userConfig.logs as Record<string, unknown>).length) {\n      delete userConfig.logs;\n    }\n\n    const context = await createClient(\n      userConfig as unknown as Required<Parameters<typeof createClient>>[0],\n    );\n    if (\n      !context[0]?.config.input.some(\n        (input) => input.watch && input.watch.enabled,\n      )\n    ) {\n      process.exit(0);\n    }\n  } catch {\n    process.exit(1);\n  }\n};\n","#!/usr/bin/env node\n\nimport { runCli } from '~/cli';\n\nrunCli();\n"],"mappings":";;;;oJCOA,MAAM,EACJ,GAEI,IAAU,OAAe,GACzB,IAAU,QAAgB,GACvB,EAGH,GACJ,EACA,IACiB,CACjB,IAAK,IAAM,KAAO,EAAa,CAC7B,IAAM,EAAQ,EAAI,GAClB,GAAI,OAAO,GAAU,SAAU,CAC7B,IAAM,EAAc,EAAgB,EAAM,CAC1C,OAAO,EAAI,GACX,EAAI,GAAO,GAGf,OAAO,GAGI,EAAS,SAA2B,CAC/C,IAAM,EAAS,IAAIA,EAAAA,SAAS,CACzB,KAAK,OAAO,KAAKC,EAAQ,CAAC,GAAI,CAC9B,MAAM,YAAY,CAClB,QAAQC,EAAY,CACpB,OAAO,uBAAwB,0BAA0B,CACzD,OAAO,cAAe,yBAAyB,CAC/C,OAAO,oBAAqB,8BAA8B,CAC1D,OAAO,qBAAsB,0BAA0B,CACvD,OACC,sBACA,uDACD,CACA,OAAO,qBAAsB,cAAc,CAC3C,OAAO,uBAAwB,gBAAgB,CAC/C,OAAO,2BAA4B,oCAAoC,CACvE,OAAO,eAAgB,0BAA0B,CACjD,OACC,gBACA,yFACD,CACA,OACC,sBACA,qDACD,CACA,MAAM,QAAQ,KAAK,CACnB,MAAM,CAELC,EAEJ,GAAI,CACF,EAAa,EAAc,EAAQ,CAAC,SAAU,UAAU,CAAC,CAErD,EAAW,OACb,EAAW,WAAa,EAAW,KACnC,OAAO,EAAW,MAGhB,EAAO,UAAY,GACrB,EAAW,QAAU,EAAE,CACd,EAAO,QAChB,EAAW,QAAU,EAAO,QACnB,EAAW,SACpB,EAAW,QAAU,CAAC,sBAAuB,eAAe,EAG1D,EAAW,SACZ,EAAW,QAA0B,KAAK,EAAW,OAAiB,CACvE,OAAO,EAAW,QAGpB,EAAW,KAAO,EAAW,KACzB,CACE,KAAM,EAAW,KAClB,CACD,EAAE,CAEF,EAAW,OACZ,EAAW,KAAiC,MAAQ,QACrD,OAAO,EAAW,OACT,EAAW,SACnB,EAAW,KAAiC,MAAQ,SACrD,OAAO,EAAW,QAGnB,EAAW,KAAiC,KAAO,EAAW,QAC/D,OAAO,EAAW,QAEd,OAAO,EAAO,OAAU,WAC1B,EAAW,MAAQ,OAAO,SAAS,EAAO,MAAO,GAAG,EAGjD,OAAO,KAAK,EAAW,KAAgC,CAAC,QAC3D,OAAO,EAAW,MAGJ,MAAMC,EAAAA,EACpB,EACD,EAEU,IAAI,OAAO,MAAM,KACvB,GAAU,EAAM,OAAS,EAAM,MAAM,QACvC,EAED,QAAQ,KAAK,EAAE,MAEX,CACN,QAAQ,KAAK,EAAE,GCjHnB,GAAQ"}